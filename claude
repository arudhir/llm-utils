#!/usr/bin/env python3

import argparse
import os
import sys
import anthropic

MODEL_MAPPING = {
    "sonnet35": "claude-3-5-sonnet-20240620",
    "opus3": "claude-3-opus-20240229",
    "sonnet3": "claude-3-sonnet-20240229",
    "haiku3": "claude-3-haiku-20240307"
}

def main():
    parser = argparse.ArgumentParser(description="Command-line interface for Claude API")
    parser.add_argument("text", help="The text to send to Claude")
    parser.add_argument("--system", help="Optional system message to set context", default="")
    parser.add_argument("--model", help="Model to use", default="sonnet35",
                        choices=MODEL_MAPPING.keys())
    parser.add_argument("--verbose", action="store_true", help="Print additional information")
    
    args = parser.parse_args()

    api_key = os.getenv("ANTHROPIC_API_KEY")
    if not api_key:
        print("Error: ANTHROPIC_API_KEY environment variable not set", file=sys.stderr)
        sys.exit(1)

    client = anthropic.Anthropic(api_key=api_key)

    try:
        if args.verbose:
            print(f"Using model: {MODEL_MAPPING[args.model]}")
            print(f"System message: {args.system}")
            print(f"User message: {args.text}")
            print("Sending request to Claude...")

        response = client.messages.create(
            model=MODEL_MAPPING[args.model],
            max_tokens=1000,
            system=args.system,
            messages=[
                {"role": "user", "content": args.text}
            ]
        )

        print("Claude's response:")
        print(response.content[0].text)

    except Exception as e:
        print(f"Error: {str(e)}", file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()
